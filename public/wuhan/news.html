<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
      <title>2020年武汉新型冠状病毒可视化</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="2020 wuhan Novel coronavirus">

    <meta name="keywords" content="2020 wuhan Novel coronavirus">
    <meta name="author" content="cuihuan">
    <meta name="robots" content="index,follow">


    <link rel="stylesheet" type="text/css" href="./static/css/common.css"/>
    <link rel="stylesheet" type="text/css" href="./static/js/zui/css/zui-theme.css"/>
    <link rel="stylesheet" type="text/css" href="./static/js/zui/css/zui.css"/>
    <link rel="stylesheet" type="text/css" href="./static/js/zui/lib/chosen/chosen.min.css"/>

    <script type="text/javascript" src="./static/js/jquery/jquery2.0.min.js"></script>
    <script type="text/javascript" src="./static/js/common.js"></script>

</head>

<body>
<nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">武汉加油</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">
                <span class="muted">武汉加油</span>
            </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li ><a href="./novelCoronavirus.html" target="_self"><i class="icon icon-line-chart"></i> 数据可视化</a></li>
                <li class="active"><a href="./news.html" target="_self"><i class="icon icon-newspaper-o"></i> 最新新闻</a></li>
                <li><a href="./sars.html" target="_self"><i class="icon icon-globe"></i> sars对比</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="./statement.html" target="_blank"><i class="icon icon-chat"></i> 声明</a></li>
            </ul>
        </div>

    </div>
</nav>

<div class="container">
    <div class="alert alert-primary" style="height: 100%">
        各省最新疫情信息：
        <div id="provinceChosen"></div>
    </div>

    <div class="alert alert-success core-data" style="height: 100%">
    </div>


    <div class="items">
    </div>
</div>
<div class="page-footer clear">

    <div class="copyright" style="color:#999999">
        <div >
            请勿用于任务商业用途
        </div>
        <div id="cr_1">
             交流网站：<a href="">cuihuan.net</a>
        </div>
        <div id="cr_2">Copyright © <span class=""> cuihuan </span>
        </div>

    </div>
</div>

</body>
</html>
<script type="text/javascript" src="./static/js/zui/js/zui.js"></script>
<script type="text/javascript" src="./static/js/zui/lib/chosen/chosen.min.js"></script>
<script type="text/javascript">
    var dataUrl  = "http://lab.isaaclin.cn/nCoV/";
    $(document).ready(function () {
        initChosen();
        initNews('');
        initCoreData('');
    });

    var initNews = function(province) {
        $.ajax({
            url: dataUrl + 'api/news?province=' + province,
            type: 'get',
            success: function (res) {
                if (res.success===true ){
                    var news = res.results;
                    var html = "";
                    for (var i in news) {
                         html +='<div class="item">\n' +
                            '            <div class="item-heading">\n' +
                            '                <div class="pull-right label label-success news-province">'+news[i].provinceName+'</div>\n' +
                            '                <h4><a href="'+news[i].sourceUrl+'" class="news-title" target="_blank">'+news[i].title+'</a></h4>\n' +
                            '            </div>\n' +
                            '            <div class="item-content news-detail" >。\n' + news[i].summary+
                            '            </div>\n' +
                            '            <div class="item-footer">\n' +
                            '                <a href="#" class="text-muted"><i class="icon-comments news-source"></i> '+news[i].infoSource+'</a> &nbsp; <span class="text-muted news-time">'+new Date(news[i].pubDate).toLocaleString()+'</span>\n' +
                            '            </div>\n' +
                            '        </div>';
                    }

                    $(".items").html(html);

                    return ;
                }
                alert("获取数据失败");

            }
        })

    };

    var initChosen = function () {
        $.ajax({
            url: dataUrl + 'api/provinceName',
            type: 'get',
            success: function (res) {
                if (res.success===true ){
                    var provinces = res.results;
                    var html = '<select data-placeholder="选择一个省份，支持缩写" class="chosen-select form-control" tabindex="2">' +
                        '<option value="">全国</option>';
                    for (var i in provinces) {
                        html += '<option value="' + provinces[i] + '">' + provinces[i] + '</option>';
                    }
                    html += '</select>';
                    $("#provinceChosen").html(html);

                    $('select.chosen-select').chosen({
                        no_results_text: '没有找到',    // 当检索时没有找到匹配项时显示的提示文本
                        disable_search_threshold: 4, // 10 个以下的选择项则不显示检索框
                        search_contains: true         // 从任意位置开始检索
                    });

                    $('select.chosen-select').on('change', function () {
                        var province = $('select.chosen-select').val();
                        initNews(province);
                        initCoreData(province);
                    });

                    return;
                }
                alert("获取数据失败");
            }
        });
    };


    var initCoreData = function (province) {

        $.ajax({
            url: dataUrl + 'api/area?latest=1&province=' + province,
            type: 'get',
            success: function (res) {
                if (res.success === true) {
                    var outBreakData = res.results;
                    var confirm  = 0;
                    var suspectedCount  = 0;
                    var curedCount  = 0;
                    var deadCount  = 0;

                    for (var i in outBreakData) {
                        confirm+=outBreakData[i].confirmedCount;
                        suspectedCount+=outBreakData[i].suspectedCount;
                        curedCount+=outBreakData[i].curedCount;
                        deadCount+=outBreakData[i].deadCount;
                    }
                    var html = ' 疫情数据:\n' +
                        '        <div>' +
                        '<span class="label label-warning data-confirmed">确诊</span>：'+confirm+' &nbsp;&nbsp;&nbsp; ' +
                        '<span class="label label-success data-cured">治愈</span>：'+curedCount+'  &nbsp;&nbsp;&nbsp; <span class="label label-danger data-dead">死亡</span>：'+deadCount+'</div>\n' +
                        '    ';


                    $(".core-data").html(html);

                    return;
                }
                alert("获取数据失败");

            }
        })

    }
</script>
